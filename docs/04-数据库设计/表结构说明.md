# 各表字段含义、索引说明

## 用户表（User）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 用户ID | PRIMARY |
| username | String | NOT NULL | 用户名 | UNIQUE |
| email | String | NOT NULL | 邮箱地址 | UNIQUE, INDEX |
| password | String | NOT NULL | 加密后的密码 | - |
| avatar | String | DEFAULT NULL | 头像URL | - |
| phone | String | DEFAULT NULL | 手机号码 | INDEX |
| isActive | Boolean | DEFAULT true | 账号是否激活 | INDEX |
| isDeleted | Boolean | DEFAULT false | 是否删除 | INDEX |
| lastLoginAt | DateTime | DEFAULT NULL | 最后登录时间 | - |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 小说表（Novel）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 小说ID | PRIMARY |
| title | String | NOT NULL | 小说标题 | INDEX |
| author | String | NOT NULL | 作者 | INDEX |
| cover | String | NOT NULL | 封面图片URL | - |
| description | Text | NOT NULL | 小说简介 | - |
| category | String | DEFAULT NULL | 分类 | INDEX |
| chapterCount | Integer | DEFAULT 0 | 章节总数 | INDEX |
| totalDuration | Integer | DEFAULT 0 | 总时长（秒） | - |
| isVip | Boolean | DEFAULT false | 是否VIP内容 | INDEX |
| isHot | Boolean | DEFAULT false | 是否热门 | INDEX |
| isNew | Boolean | DEFAULT false | 是否新书 | INDEX |
| status | String | DEFAULT 'ongoing' | 状态（ongoing/completed） | INDEX |
| viewCount | Integer | DEFAULT 0 | 浏览次数 | INDEX |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 章节表（Chapter）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 章节ID | PRIMARY |
| novelId | String | NOT NULL, FOREIGN KEY | 所属小说ID | INDEX, FOREIGN |
| chapterNumber | Integer | NOT NULL | 章节序号 | INDEX |
| title | String | NOT NULL | 章节标题 | - |
| content | Text | DEFAULT NULL | 章节文本内容 | - |
| duration | Integer | DEFAULT 0 | 音频时长（秒） | - |
| isVip | Boolean | DEFAULT false | 是否VIP章节 | INDEX |
| wordCount | Integer | DEFAULT 0 | 字数 | - |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 音频表（Audio）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 音频ID | PRIMARY |
| chapterId | String | NOT NULL, FOREIGN KEY, UNIQUE | 所属章节ID | INDEX, FOREIGN |
| url | String | NOT NULL | 音频文件URL | - |
| format | String | DEFAULT 'mp3' | 音频格式 | - |
| size | Integer | DEFAULT 0 | 文件大小（字节） | - |
| bitrate | Integer | DEFAULT 128 | 比特率 | - |
| status | String | DEFAULT 'pending' | 生成状态（pending/processing/completed/failed） | INDEX |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 小说收藏表（Collection）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 收藏记录ID | PRIMARY |
| userId | String | NOT NULL, FOREIGN KEY | 用户ID | INDEX, FOREIGN |
| novelId | String | NOT NULL, FOREIGN KEY | 小说ID | INDEX, FOREIGN |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 收藏时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

**复合索引**：(userId, novelId) - 确保用户不会重复收藏同一本小说

## 播放记录表（PlayHistory）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 记录ID | PRIMARY |
| userId | String | NOT NULL, FOREIGN KEY | 用户ID | INDEX, FOREIGN |
| novelId | String | NOT NULL | 小说ID | INDEX |
| chapterId | String | NOT NULL, FOREIGN KEY | 章节ID | INDEX, FOREIGN |
| progress | Integer | DEFAULT 0 | 播放进度（秒） | - |
| isFinished | Boolean | DEFAULT false | 是否已完成 | - |
| lastPlayedAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 最后播放时间 | INDEX |

**复合索引**：(userId, chapterId) - 确保每个用户对每个章节只有一条记录

## 会员信息表（VipInfo）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 会员信息ID | PRIMARY |
| userId | String | NOT NULL, FOREIGN KEY, UNIQUE | 用户ID | INDEX, FOREIGN |
| vipLevel | Integer | DEFAULT 1 | 会员等级 | INDEX |
| startDate | DateTime | NOT NULL | 会员开始时间 | - |
| expireDate | DateTime | NOT NULL | 会员到期时间 | INDEX |
| isActive | Boolean | DEFAULT true | 是否有效 | INDEX |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 会员套餐表（VipPackage）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 套餐ID | PRIMARY |
| name | String | NOT NULL | 套餐名称 | INDEX |
| duration | Integer | NOT NULL | 有效期（天） | - |
| price | Decimal | NOT NULL | 价格 | - |
| originalPrice | Decimal | DEFAULT 0 | 原价 | - |
| description | String | DEFAULT NULL | 套餐描述 | - |
| isActive | Boolean | DEFAULT true | 是否启用 | INDEX |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 订单表（Order）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 订单ID | PRIMARY |
| userId | String | NOT NULL, FOREIGN KEY | 用户ID | INDEX, FOREIGN |
| packageId | String | NOT NULL, FOREIGN KEY | 套餐ID | INDEX, FOREIGN |
| orderNo | String | NOT NULL | 订单号 | UNIQUE, INDEX |
| amount | Decimal | NOT NULL | 订单金额 | - |
| paymentMethod | String | DEFAULT NULL | 支付方式 | - |
| status | String | DEFAULT 'pending' | 订单状态（pending/paid/cancelled/refunded） | INDEX |
| paymentTime | DateTime | DEFAULT NULL | 支付时间 | - |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | INDEX |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 支付记录表（Payment）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 支付记录ID | PRIMARY |
| orderId | String | NOT NULL, FOREIGN KEY | 订单ID | INDEX, FOREIGN |
| paymentId | String | DEFAULT NULL | 支付平台交易号 | - |
| amount | Decimal | NOT NULL | 支付金额 | - |
| status | String | DEFAULT 'pending' | 支付状态（pending/success/failed） | INDEX |
| gateway | String | DEFAULT NULL | 支付网关 | - |
| paidAt | DateTime | DEFAULT NULL | 支付成功时间 | - |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 分类表（Category）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 分类ID | PRIMARY |
| name | String | NOT NULL | 分类名称 | UNIQUE, INDEX |
| description | String | DEFAULT NULL | 分类描述 | - |
| sort | Integer | DEFAULT 0 | 排序序号 | INDEX |
| isActive | Boolean | DEFAULT true | 是否启用 | INDEX |
| createdAt | DateTime | DEFAULT CURRENT_TIMESTAMP | 创建时间 | - |
| updatedAt | DateTime | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 小说分类关联表（NovelCategory）

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | String | PRIMARY KEY | 关联ID | PRIMARY |
| novelId | String | NOT NULL, FOREIGN KEY | 小说ID | INDEX, FOREIGN |
| categoryId | String | NOT NULL, FOREIGN KEY | 分类ID | INDEX, FOREIGN |

**复合索引**：(novelId, categoryId) - 确保小说不会重复关联同一分类

## 索引优化建议

1. **查询性能优化**
   - 对于频繁用于查询条件的字段创建索引
   - 对于经常排序的字段创建索引
   - 对于外键字段创建索引，提高连接查询性能

2. **复合索引使用**
   - 根据最左前缀原则设计复合索引
   - 为频繁一起使用的查询条件创建复合索引
   - 避免创建过多不必要的索引，影响写操作性能

3. **定期维护**
   - 定期分析表结构，优化索引
   - 对于大数据量的表，考虑分表或分区策略
   - 监控慢查询日志，优化查询语句和索引