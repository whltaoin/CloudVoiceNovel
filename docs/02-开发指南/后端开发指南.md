# 环境搭建、数据库配置、启动顺序

## 开发环境搭建

### 前提条件
- Node.js 16.x 或更高版本
- npm 或 yarn
- MongoDB/MySQL/PostgreSQL（根据选择的数据库）
- Redis
- Git

### 安装步骤
1. **克隆仓库**
   ```bash
   git clone [仓库地址]
   cd CloudVoiceNovel/backend
   ```

2. **安装依赖**
   ```bash
   npm install
   # 或
   yarn install
   ```

3. **配置环境变量**
   - 复制 `.env.example` 文件为 `.env`
   - 填写数据库连接信息、API密钥等配置

## 数据库配置

### MongoDB 配置
1. **安装 MongoDB**
   - 本地开发可使用 MongoDB Compass 或 Docker
   - 生产环境建议使用 MongoDB Atlas

2. **数据库连接配置**
   ```
   # .env 文件中配置
   MONGODB_URI=mongodb://localhost:27017/cloudvoicenovel
   ```

3. **数据库迁移**
   ```bash
   npm run migrate:mongodb
   ```

### MySQL/PostgreSQL 配置
1. **安装数据库**
   - 本地开发可使用 XAMPP、Docker 等

2. **创建数据库**
   ```sql
   CREATE DATABASE cloudvoicenovel;
   ```

3. **数据库连接配置**
   ```
   # .env 文件中配置
   DB_HOST=localhost
   DB_PORT=3306
   DB_USER=root
   DB_PASSWORD=password
   DB_NAME=cloudvoicenovel
   ```

4. **数据库迁移**
   ```bash
   npm run migrate
   ```

### Redis 配置
1. **安装 Redis**
   - 本地开发可使用 Docker 或直接安装

2. **Redis 连接配置**
   ```
   # .env 文件中配置
   REDIS_URL=redis://localhost:6379
   ```

## 启动顺序

### 开发环境启动
1. **启动数据库服务**
   - 确保 MongoDB/MySQL 和 Redis 服务已启动

2. **启动后端服务**
   ```bash
   npm run dev
   # 或
   yarn dev
   ```

### 生产环境启动
1. **构建项目**
   ```bash
   npm run build
   # 或
   yarn build
   ```

2. **启动服务**
   ```bash
   npm start
   # 或
   yarn start
   ```

## 开发规范

### 目录结构
```
backend/
├── src/
│   ├── controllers/     # 控制器
│   ├── services/        # 业务逻辑层
│   ├── models/          # 数据模型
│   ├── routes/          # 路由配置
│   ├── middlewares/     # 中间件
│   ├── utils/           # 工具函数
│   ├── config/          # 配置文件
│   ├── schemas/         # 数据校验模式
│   └── app.ts           # 应用入口
├── tests/               # 测试文件
└── scripts/             # 脚本文件
```

### 代码规范
- 使用 ESLint 和 Prettier 确保代码质量
- 遵循 RESTful API 设计规范
- 使用 TypeScript 确保类型安全
- 函数命名使用 camelCase
- 类命名使用 PascalCase

### API 开发规范
1. **路由设计**
   - 资源路径使用复数形式
   - HTTP 方法使用规范：GET、POST、PUT、DELETE

2. **错误处理**
   - 统一错误响应格式
   - 合理设置 HTTP 状态码

3. **日志记录**
   - 记录请求/响应日志
   - 记录错误日志

4. **安全措施**
   - 请求参数校验
   - 防 SQL 注入
   - XSS 防护
   - 频率限制

## 测试规范
- 使用 Jest 进行单元测试和集成测试
- API 测试使用 Supertest
- 关键功能必须编写测试用例

## 提交规范
- 提交信息使用语义化提交格式
- 例如：`feat: 添加用户认证接口`、`fix: 修复数据查询问题`

## 其他注意事项
- 开发新功能前先创建对应的分支
- 代码提交前运行测试确保功能正常
- 定期合并主分支更新